name: Build Kivy APK

on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:   # –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é
  release:
    types: [created]   # –∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ä–µ–ª–∏–∑–∞

jobs:
  build:
    name: Build Android APK
    runs-on: ubuntu-latest

    # üê≥ –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å –≥–æ—Ç–æ–≤—ã–º Buildozer + Android SDK/NDK
    container:
      image: kivy/buildozer:latest

    steps:
      # 1Ô∏è‚É£ –ö–ª–æ–Ω–∏—Ä—É–µ–º –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å requirements.txt)
      - name: Install Python dependencies
        run: |
          if [ -f "requirements.txt" ]; then
            pip install -r requirements.txt
          fi

      # 3Ô∏è‚É£ –°–±–æ—Ä–∫–∞ APK (debug)
      - name: Build APK with Buildozer
        run: |
          buildozer android debug

      # 4Ô∏è‚É£ –ó–∞–≥—Ä—É–∂–∞–µ–º APK –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç
      - name: Upload built APK
        uses: actions/upload-artifact@v4
        with:
          name: kivy-app-apk
          path: bin/*.apk

      # 5Ô∏è‚É£ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ GitHub Releases, –µ—Å–ª–∏ —ç—Ç–æ —Ä–µ–ª–∏–∑
      - name: Upload to GitHub Releases
        if: startsWith(github.ref, 'refs/tags/')
        uses: softprops/action-gh-release@v2
        with:
          files: bin/*.apk
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
